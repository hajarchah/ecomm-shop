<div class="cart-view p-4">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <ng-container *ngIf="cartItems$ | async as cartItems">
    <div *ngIf="cartItems.length === 0" class="empty-cart text-center p-6">
      <i class="pi pi-shopping-cart mb-3" style="font-size: 3rem"></i>
      <h2>Your cart is empty</h2>
      <p class="mb-4">Add some products to your cart</p>
      <button pButton label="Continue Shopping" routerLink="/products"></button>
    </div>

    <div *ngIf="cartItems.length > 0">
      <p-table [value]="cartItems" [tableStyle]="{'min-width': '50rem'}">
        <ng-template pTemplate="header">
          <tr>
            <th>Product</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Subtotal</th>
            <th></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>{{item.product.name}}</td>
            <td>{{item.product.price | currency:'EUR'}}</td>
            <td>
              <p-inputNumber 
                [ngModel]="item.quantity"
                (ngModelChange)="updateQuantity(item, $event)"
                [showButtons]="true" 
                [min]="1"
                buttonLayout="horizontal"
                spinnerMode="horizontal"
                [step]="1"
                decrementButtonClass="p-button-secondary"
                incrementButtonClass="p-button-secondary"
                incrementButtonIcon="pi pi-plus"
                decrementButtonIcon="pi pi-minus">
              </p-inputNumber>
            </td>
            <td>{{item.product.price * item.quantity | currency:'EUR'}}</td>
            <td>
              <button 
                pButton 
                icon="pi pi-trash" 
                class="p-button-danger p-button-text"
                (click)="removeItem(item)">
              </button>
            </td>
          </tr>
        </ng-template>
      </p-table>

      <div class="flex justify-content-end mt-4">
        <p-card styleClass="w-25rem">
          <ng-template pTemplate="title">
            Order Summary
          </ng-template>
          <ng-template pTemplate="content">
            <div class="flex justify-content-between mb-3">
              <span>Subtotal</span>
              <span>{{subtotal$ | async | currency:'EUR'}}</span>
            </div>
            <div class="flex justify-content-between mb-3">
              <span>Tax (20%)</span>
              <span>{{tax$ | async | currency:'EUR'}}</span>
            </div>
            <p-divider></p-divider>
            <div class="flex justify-content-between font-bold">
              <span>Total</span>
              <span>{{total$ | async | currency:'EUR'}}</span>
            </div>
          </ng-template>
          <ng-template pTemplate="footer">
            <div class="flex flex-column gap-2">
              <button pButton label="Proceed to Checkout" 
                      (click)="onCheckout()">
              </button>
              <button pButton label="Clear Cart" 
                      class="p-button-outlined p-button-danger"
                      (click)="clearCart()">
              </button>
            </div>
          </ng-template>
        </p-card>
      </div>
    </div>
  </ng-container>
</div>